<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>马年新春拜年 · 凉州祈福</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
theme: {
extend: {
colors: {
chinese: {
red: '#C41E3A',
dark: '#8B0000',
gold: '#FFD700',
bronze: '#CD7F32',
cream: '#FFF8DC'
}
},
fontFamily: {
calligraphy: ['Ma Shan Zheng', 'cursive'],
display: ['Noto Serif SC', 'serif']
}
}
}
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}

body {
font-family: 'Noto Serif SC', serif;
overflow: hidden;
touch-action: pan-y;
}

/* 粒子动画 */
@keyframes float {
0%, 100% { transform: translateY(0) rotate(0deg); opacity: 1; }
50% { transform: translateY(-20px) rotate(180deg); opacity: 0.6; }
}

@keyframes sparkle {
0%, 100% { opacity: 0; transform: scale(0); }
50% { opacity: 1; transform: scale(1); }
}

@keyframes glow {
0%, 100% { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
50% { text-shadow: 0 0 40px rgba(255, 215, 0, 0.9), 0 0 60px rgba(255, 215, 0, 0.5); }
}

@keyframes breathe {
0%, 100% { transform: scale(1); }
50% { transform: scale(1.02); }
}

/* 吸附动画 */
@keyframes snapShake {
0% { transform: translateX(0); }
25% { transform: translateX(-2px); }
50% { transform: translateX(2px); }
75% { transform: translateX(-1px); }
100% { transform: translateX(0); }
}

/* 签选中动画 */
@keyframes selectBounce {
0% { transform: translateY(0) scale(1); }
50% { transform: translateY(-30px) scale(1.15); }
100% { transform: translateY(-25px) scale(1.15); }
}

.particle {
position: absolute;
pointer-events: none;
animation: float linear infinite;
}

.sparkle {
position: absolute;
width: 4px;
height: 4px;
background: radial-gradient(circle, #FFD700, transparent);
border-radius: 50%;
animation: sparkle 2s ease-in-out infinite;
}

/* 签筒容器 */
.qian-container {
perspective: 1200px;
transform-style: preserve-3d;
}

/* 单支签 - 尺寸放大 */
.qian-stick {
position: absolute;
width: 34px;
height: 220px;
cursor: pointer;
transform-style: preserve-3d;
transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
}

.qian-stick:hover {
transform: translateY(-15px) scale(1.1);
z-index: 100;
}

.qian-stick.selected {
animation: selectBounce 0.5s ease-out forwards;
z-index: 101;
}

/* 吸附震动反馈 */
.qian-stick.snap-effect {
animation: snapShake 0.3s ease-out;
}

.qian-body {
width: 100%;
height: 100%;
background: linear-gradient(90deg, #D2691E 0%, #DEB887 30%, #F5DEB3 50%, #DEB887 70%, #D2691E 100%);
border-radius: 4px 4px 8px 8px;
box-shadow: 
inset 3px 0 5px rgba(0,0,0,0.2),
inset -3px 0 5px rgba(0,0,0,0.2),
4px 6px 18px rgba(0,0,0,0.5);
position: relative;
overflow: hidden;
}

.qian-body::before {
content: '';
position: absolute;
top: 0;
left: 50%;
transform: translateX(-50%);
width: 24px;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
}

.qian-top {
position: absolute;
top: 0;
left: 0;
right: 0;
height: 42px;
background: linear-gradient(180deg, #8B0000, #C41E3A);
border-radius: 4px 4px 0 0;
display: flex;
align-items: center;
justify-content: center;
box-shadow: 0 3px 10px rgba(0,0,0,0.3);
}

.qian-top::after {
content: '吉';
font-family: 'Ma Shan Zheng', cursive;
font-size: 22px;
color: #FFD700;
text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
}

/* 隐藏签的数字 */
.qian-number {
display: none;
}

/* 抽签结果面板 */
.result-panel {
backdrop-filter: blur(20px);
background: linear-gradient(135deg, rgba(139, 0, 0, 0.85), rgba(196, 30, 58, 0.75));
border: 2px solid rgba(255, 215, 0, 0.3);
box-shadow: 
0 25px 50px rgba(0, 0, 0, 0.5),
inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

/* 翻牌效果 */
.flip-card {
perspective: 1000px;
width: 200px;
height: 280px;
}

.flip-card-inner {
position: relative;
width: 100%;
height: 100%;
transform-style: preserve-3d;
transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

.flip-card.flipped .flip-card-inner {
transform: rotateY(180deg);
}

.flip-card-front, .flip-card-back {
position: absolute;
width: 100%;
height: 100%;
backface-visibility: hidden;
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
}

.flip-card-back {
transform: rotateY(180deg);
background: linear-gradient(135deg, #FFF8DC, #FAEBD7);
border: 3px solid #FFD700;
box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
}

/* 金色祝福文字 */
.gold-text {
background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
animation: glow 2s ease-in-out infinite;
filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
}

/* 装饰元素 */
.decoration-circle {
position: absolute;
border-radius: 50%;
background: radial-gradient(circle, rgba(255, 215, 0, 0.1), transparent);
pointer-events: none;
}

/* 马踏飞燕图标 */
.horse-icon {
filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
animation: breathe 3s ease-in-out infinite;
}

/* 滑动提示 */
.swipe-hint {
animation: breathe 2s ease-in-out infinite;
}

/* 烟花Canvas */
#fireworksCanvas {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
pointer-events: none;
z-index: 9999;
}

/* 加载动画 */
.loading-overlay {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: linear-gradient(to-br, #8B0000, #C41E3A);
display: flex;
align-items: center;
justify-content: center;
z-index: 99999;
transition: opacity 0.8s ease-out;
}

.loading-text {
font-family: 'Ma Shan Zheng', cursive;
font-size: 3rem;
color: #FFD700;
text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
animation: glow 2s ease-in-out infinite, breathe 2s ease-in-out infinite;
}

/* 响应式 */
@media (max-width: 640px) {
.qian-stick {
width: 28px;
height: 180px;
}
.qian-top {
height: 35px;
}
.qian-top::after {
font-size: 18px;
}
.flip-card {
width: 180px;
height: 250px;
}
.loading-text {
font-size: 2rem;
}
}

@media (max-width: 480px) {
.qian-stick {
width: 24px;
height: 160px;
}
#qianTong {
width: 70vw !important;
height: 70vw !important;
}
}

@media (prefers-reduced-motion: reduce) {
*, *::before, *::after {
animation-duration: 0.01ms !important;
transition-duration: 0.01ms !important;
}
}
</style>
</head>
<body class="bg-gradient-to-br from-chinese-dark via-chinese-red to-red-900 min-h-screen overflow-hidden relative">

<!-- 加载动画 -->
<div class="loading-overlay" id="loadingOverlay">
<div class="loading-text">马年大吉</div>
</div>

<!-- 烟花Canvas -->
<canvas id="fireworksCanvas"></canvas>

<!-- 背景装饰 -->
<div class="fixed inset-0 overflow-hidden pointer-events-none">
<!-- 装饰圆 -->
<div class="decoration-circle" style="width: 400px; height: 400px; top: -100px; right: -100px;"></div>
<div class="decoration-circle" style="width: 300px; height: 300px; bottom: -50px; left: -50px;"></div>
<div class="decoration-circle" style="width: 200px; height: 200px; top: 50%; left: 10%;"></div>

<!-- 粒子容器 -->
<div id="particles"></div>

<!-- 光晕效果 -->
<div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-96 h-96 bg-gradient-radial from-yellow-500/10 to-transparent rounded-full blur-3xl"></div>
</div>

<!-- 主内容 -->
<div class="relative z-10 min-h-screen flex flex-col">

<!-- 顶部标题 -->
<header class="pt-8 pb-4 text-center">
<h1 class="font-calligraphy text-4xl md:text-5xl text-chinese-gold drop-shadow-lg mb-2 animate-pulse">
马年新春祈福
</h1>
<!-- 年份标识 -->
<p class="text-chinese-gold text-lg md:text-xl font-bold tracking-widest mb-2" style="text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);">
丙午马年
</p>
<p class="text-chinese-cream/80 text-sm md:text-base tracking-widest">
凉州古韵 · 丝路福签
</p>
<div class="flex items-center justify-center gap-3 mt-3">
<div class="w-16 h-px bg-gradient-to-r from-transparent via-chinese-gold to-transparent"></div>
<i class="fas fa-horse text-chinese-gold text-lg horse-icon"></i>
<div class="w-16 h-px bg-gradient-to-r from-transparent via-chinese-gold to-transparent"></div>
</div>
</header>

<!-- 签筒区域 -->
<main class="flex-1 flex flex-col items-center justify-center px-4">
<!-- 签筒 -->
<div id="qianTong" class="qian-container relative w-80 h-80 md:w-96 md:h-96 mb-6">
<!-- 32支签将通过JS生成 -->
</div>

<!-- 操作提示 -->
<div id="hint" class="text-center">
<p class="swipe-hint text-chinese-cream/90 text-sm md:text-base mb-3">
<i class="fas fa-hand-pointer mr-2"></i>滑动选择签，点击抽取
</p>
<div class="flex items-center justify-center gap-2">
<span class="text-chinese-gold text-xs">已选：</span>
<span id="selectedNum" class="text-chinese-gold font-bold">第 1 签</span>
</div>
</main>

<!-- 底部信息 -->
<footer class="pb-6 text-center">
<p class="text-chinese-cream text-base md:text-lg font-bold whitespace-nowrap tracking-wide">
徐世杰给您拜年啦！
</p>
</footer>
</div>

<!-- 抽签结果弹窗 -->
<div id="resultModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
<div class="absolute inset-0 bg-black/70 backdrop-blur-sm" onclick="closeResult()"></div>
<div class="relative result-panel rounded-3xl p-6 md:p-8 max-w-sm w-full transform transition-all duration-500 scale-95 opacity-0" id="resultContent">
<!-- 关闭按钮 -->
<button onclick="closeResult()" class="absolute top-4 right-4 text-chinese-cream/60 hover:text-chinese-gold transition-colors">
<i class="fas fa-times text-xl"></i>
</button>

<!-- 签号 -->
<div class="text-center mb-4">
<span class="inline-block px-4 py-1 bg-chinese-gold/20 rounded-full text-chinese-gold text-sm">
第 <span id="resultNum">1</span> 签
</span>
</div>

<!-- 翻牌容器 -->
<div class="flex justify-center mb-6">
<div class="flip-card" id="flipCard">
<div class="flip-card-inner">
<div class="flip-card-front bg-gradient-to-br from-chinese-red to-chinese-dark border-2 border-chinese-gold/50 rounded-xl flex items-center justify-center">
<div class="text-center">
<i class="fas fa-horse text-chinese-gold text-4xl mb-3 animate-bounce"></i>
<p class="text-chinese-cream font-calligraphy text-2xl">点击翻开</p>
</div>
</div>
<div class="flip-card-back p-4">
<div class="text-center">
<p class="text-chinese-dark font-calligraphy text-lg leading-relaxed" id="qianText">
签文内容
</p>
</div>
</div>
</div>
</div>
</div>

<!-- 金色祝福语 -->
<div id="blessingText" class="text-center opacity-0 transition-all duration-1000 transform translate-y-4">
<p class="font-calligraphy text-2xl md:text-3xl gold-text mb-4">
马年，祝你万事如意
</p>
<p class="text-chinese-cream/80 text-sm" id="blessingDetail">
祝福详情
</p>
</div>

<!-- 操作按钮 -->
<div class="mt-6 text-center">
<button onclick="drawAgain()" class="px-10 py-4 bg-chinese-gold hover:bg-yellow-500 rounded-full text-chinese-dark font-bold text-lg transition-all transform hover:scale-105 shadow-lg active:scale-95">
<i class="fas fa-redo mr-2"></i>再抽一签
</button>
</div>
</div>
</div>

<script>
// ================== 烟花效果逻辑 ==================
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
let fireworks = [];
let particles = [];
let isFireworksActive = false;

function resizeCanvas() {
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// 烟花类
class Firework {
constructor() {
this.x = Math.random() * canvas.width;
this.y = canvas.height;
this.targetY = Math.random() * canvas.height * 0.5;
this.speed = 3 + Math.random() * 3;
this.color = `hsl(${Math.random() * 60 + 10}, 100%, 60%)`; // 金色和红色系
this.radius = 2;
this.trail = [];
}

update() {
this.trail.push({ x: this.x, y: this.y });
if (this.trail.length > 10) this.trail.shift();

this.y -= this.speed;

if (this.y <= this.targetY) {
this.explode();
return false;
}
return true;
}

draw() {
ctx.beginPath();
ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
ctx.fillStyle = this.color;
ctx.fill();

// 绘制尾迹
for (let i = 0; i < this.trail.length; i++) {
const alpha = i / this.trail.length;
ctx.beginPath();
ctx.arc(this.trail[i].x, this.trail[i].y, this.radius * alpha, 0, Math.PI * 2);
ctx.fillStyle = `rgba(255, 215, 0, ${alpha})`;
ctx.fill();
}
}

explode() {
const particleCount = 80 + Math.floor(Math.random() * 50);
for (let i = 0; i < particleCount; i++) {
particles.push(new Particle(this.x, this.y, this.color));
}
}
}

// 粒子类
class Particle {
constructor(x, y, color) {
this.x = x;
this.y = y;
this.color = color;
const angle = Math.random() * Math.PI * 2;
const speed = Math.random() * 6 + 1;
this.vx = Math.cos(angle) * speed;
this.vy = Math.sin(angle) * speed;
this.alpha = 1;
this.decay = 0.015 + Math.random() * 0.02;
this.gravity = 0.05;
this.radius = 1 + Math.random();
}

update() {
this.vx *= 0.98;
this.vy *= 0.98;
this.vy += this.gravity;
this.x += this.vx;
this.y += this.vy;
this.alpha -= this.decay;
return this.alpha > 0;
}

draw() {
ctx.save();
ctx.globalAlpha = this.alpha;
ctx.beginPath();
ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
ctx.fillStyle = this.color;
ctx.fill();
ctx.restore();
}
}

function animateFireworks() {
// 如果烟花停止发射且没有粒子，清空画布并结束
if (!isFireworksActive && fireworks.length === 0 && particles.length === 0) {
ctx.clearRect(0, 0, canvas.width, canvas.height);
return;
}

// 清空画布，保持背景透明
ctx.clearRect(0, 0, canvas.width, canvas.height);

// 随机生成新烟花
if (isFireworksActive && Math.random() < 0.08) {
fireworks.push(new Firework());
}

// 更新和绘制烟花
fireworks = fireworks.filter(fw => {
fw.draw();
return fw.update();
});

// 更新和绘制粒子
particles = particles.filter(p => {
p.draw();
return p.update();
});

requestAnimationFrame(animateFireworks);
}

function startFireworks() {
isFireworksActive = true;
ctx.clearRect(0, 0, canvas.width, canvas.height);
animateFireworks();
// 2.5秒后停止发射新烟花
setTimeout(() => {
isFireworksActive = false;
}, 2500);
}

function stopFireworksLoop() {
isFireworksActive = false;
}

// ================== 签文数据与逻辑 ==================
const qianData = [
{ text: "马踏飞燕迎春至，吉祥如意送福来", blessing: "事业腾飞，如骏马奔腾" },
{ text: "天马行空任翱翔，新春如意享安康", blessing: "自由自在，健康平安" },
{ text: "葡萄美酒夜光杯，马年财源滚滚来", blessing: "财源广进，富贵吉祥" },
{ text: "汉唐雄风今犹在，马年奋进创未来", blessing: "精神焕发，前程远大" },
{ text: "沙漠绿洲春意浓，马年幸福乐无穷", blessing: "生活美满，幸福无边" },
{ text: "长城脚下迎新春，马年平安福满门", blessing: "平安吉祥，福气盈门" },
{ text: "丝路花雨润心田，马年爱情比蜜甜", blessing: "爱情甜蜜，姻缘美满" },
{ text: "马年新春第一签，祝你万事如意年", blessing: "携手共进，共创辉煌" },
{ text: "铜奔马踏千重浪，马年事业更辉煌", blessing: "事业有成，辉煌腾达" },
{ text: "凉州词韵传千古，马年大吉展宏图", blessing: "鸿运当头，大展宏图" },
{ text: "骏马奔腾开盛世，新春大吉展宏图", blessing: "时运亨通，大展宏图" },
{ text: "龙马精神壮体魄，阖家欢乐庆团圆", blessing: "身体健康，阖家幸福" },
{ text: "快马加鞭奔前程，事业顺利步步高", blessing: "事业有成，步步高升" },
{ text: "一马当先占鳌头，学业有成金榜题", blessing: "学业进步，金榜题名" },
{ text: "万马奔腾迎新岁，身体健康福寿长", blessing: "福寿安康，岁岁平安" },
{ text: "马到成功心愿遂，爱情甜蜜喜结缘", blessing: "心想事成，喜结良缘" },
{ text: "金马昂首迎富贵，财源广进福满堂", blessing: "财源滚滚，富贵盈门" },
{ text: "策马扬鞭追梦想，心想事成好运连", blessing: "梦想成真，好运连连" },
{ text: "春风得意马蹄疾，生活美满乐无忧", blessing: "生活幸福，快乐无忧" },
{ text: "马年大吉鸿运照，贵人相助事事顺", blessing: "贵人相助，万事顺遂" },
{ text: "铁马金戈气盖世，勇往直前创佳绩", blessing: "勇攀高峰，再创佳绩" },
{ text: "老马识途指迷津，智慧通达解烦忧", blessing: "智慧开启，烦恼尽消" },
{ text: "汗马功劳得赏识，职场晋升展才华", blessing: "升职加薪，才华尽显" },
{ text: "千军万马避白袍，平安健康福星照", blessing: "平安健康，福星高照" },
{ text: "马不停蹄传佳音，喜气洋洋盈门庭", blessing: "喜讯频传，喜气盈门" },
{ text: "鞍前马后得人心，人缘广结贵人多", blessing: "人缘极佳，贵人相助" },
{ text: "单枪匹马闯天涯，独立自主展锋芒", blessing: "独立自主，锋芒毕露" },
{ text: "青梅竹马两无猜，家庭和睦幸福来", blessing: "家庭和睦，幸福美满" },
{ text: "兵强马壮气势旺，团队协作赢未来", blessing: "团队协作，共创未来" },
{ text: "风樯阵马势破竹，困难化解路路通", blessing: "困难化解，路路畅通" },
{ text: "倚马可待才思涌，灵感迸发创佳作", blessing: "才思泉涌，创作丰收" },
{ text: "香车宝马迎佳客，生活富足享荣华", blessing: "生活富足，荣华富贵" }
];

// 状态变量
let currentIndex = 0;
let isDrawing = false;
let rotationAngle = 0;
let startX = 0;
let isDragging = false;
let autoRotateInterval = null;
let lastSelectedIndex = -1;

// DOM元素
const qianTong = document.getElementById('qianTong');
const selectedNum = document.getElementById('selectedNum');
const resultModal = document.getElementById('resultModal');
const resultContent = document.getElementById('resultContent');
const resultNum = document.getElementById('resultNum');
const qianText = document.getElementById('qianText');
const blessingText = document.getElementById('blessingText');
const blessingDetail = document.getElementById('blessingDetail');
const flipCard = document.getElementById('flipCard');
const particlesContainer = document.getElementById('particles');
const loadingOverlay = document.getElementById('loadingOverlay');

// 初始化签筒
function initQianTong() {
const totalQian = 32;
const radius = window.innerWidth < 640 ? 120 : 150;

for (let i = 0; i < totalQian; i++) {
const qian = document.createElement('div');
qian.className = 'qian-stick';
qian.dataset.index = i;

const angle = (i / totalQian) * Math.PI * 2;
const x = Math.sin(angle) * radius;
const z = Math.cos(angle) * radius;

qian.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${-angle * 180 / Math.PI}deg)`;

qian.innerHTML = `
<div class="qian-body">
<div class="qian-top"></div>
<span class="qian-number">${i + 1}</span>
</div>
`;

qian.addEventListener('click', () => selectQian(i));
qianTong.appendChild(qian);
}

startAutoRotate();
}

function startAutoRotate() {
autoRotateInterval = setInterval(() => {
if (!isDragging) {
rotationAngle += 0.2;
updateQianPositions();
}
}, 50);
}

function updateQianPositions() {
const totalQian = 32;
const radius = window.innerWidth < 640 ? 120 : 150;
const qians = qianTong.querySelectorAll('.qian-stick');

qians.forEach((qian, i) => {
const angle = (i / totalQian) * Math.PI * 2 + rotationAngle * Math.PI / 180;
const x = Math.sin(angle) * radius;
const z = Math.cos(angle) * radius;

qian.style.transform = `translateX(${x}px) translateZ(${z}px) rotateY(${-angle * 180 / Math.PI}deg)`;

const scale = 0.7 + (z + radius) / (radius * 2) * 0.5;
const opacity = 0.5 + (z + radius) / (radius * 2) * 0.5;
qian.style.opacity = opacity;
qian.querySelector('.qian-body').style.transform = `scale(${scale})`;
});
}

function selectQian(index) {
// 添加震动反馈
if (navigator.vibrate) {
navigator.vibrate(20);
}

currentIndex = index;
selectedNum.textContent = `第 ${index + 1} 签`;

const qians = qianTong.querySelectorAll('.qian-stick');
qians.forEach((qian, i) => {
if (i === index) {
qian.classList.add('selected');
} else {
qian.classList.remove('selected');
}
});

if (!isDrawing) {
drawQian();
}
}

function drawQian() {
isDrawing = true;
clearInterval(autoRotateInterval);

resultModal.style.display = 'flex';
setTimeout(() => {
resultContent.classList.remove('scale-95', 'opacity-0');
resultContent.classList.add('scale-100', 'opacity-100');
}, 50);

const qian = qianData[currentIndex];
resultNum.textContent = currentIndex + 1;
qianText.textContent = qian.text;
blessingDetail.textContent = qian.blessing;

flipCard.classList.remove('flipped');
blessingText.style.opacity = '0';
blessingText.style.transform = 'translateY(20px)';

createParticles();
}

// 翻牌事件
flipCard.addEventListener('click', () => {
if (!flipCard.classList.contains('flipped')) {
flipCard.classList.add('flipped');

// 触发烟花效果
startFireworks();

setTimeout(() => {
blessingText.style.opacity = '1';
blessingText.style.transform = 'translateY(0)';
}, 500);

// 创建闪耀效果
for (let i = 0; i < 30; i++) {
setTimeout(() => createSparkle(), i * 50);
}
}
});

function closeResult() {
stopFireworksLoop(); // 停止发射新烟花
ctx.clearRect(0, 0, canvas.width, canvas.height); // 清空画布
fireworks = [];
particles = [];

resultContent.classList.remove('scale-100', 'opacity-100');
resultContent.classList.add('scale-95', 'opacity-0');

setTimeout(() => {
resultModal.style.display = 'none';
isDrawing = false;
startAutoRotate();
}, 300);
}

function drawAgain() {
closeResult();
setTimeout(() => {
let newIndex;
do {
newIndex = Math.floor(Math.random() * 32);
} while (newIndex === currentIndex && qianData.length > 1);

selectQian(newIndex);
}, 400);
}

function snapToNearest() {
const totalQian = 32;
const normalizedAngle = ((rotationAngle % 360) + 360) % 360;
const nearestIndex = Math.round((normalizedAngle / 360) * totalQian) % totalQian;

const targetAngle = (nearestIndex / totalQian) * 360;
const diff = targetAngle - normalizedAngle;
rotationAngle += diff * 0.3;

updateQianPositions();
selectedNum.textContent = `第 ${nearestIndex + 1} 签`;

if (nearestIndex !== lastSelectedIndex) {
const qians = qianTong.querySelectorAll('.qian-stick');
if (qians[nearestIndex]) {
qians[nearestIndex].classList.add('snap-effect');
setTimeout(() => qians[nearestIndex].classList.remove('snap-effect'), 300);
}
if (navigator.vibrate) {
navigator.vibrate(10);
}
}

lastSelectedIndex = nearestIndex;
currentIndex = nearestIndex;
}

// 滑动交互 - 移动端
qianTong.addEventListener('touchstart', (e) => {
isDragging = true;
startX = e.touches[0].clientX;
clearInterval(autoRotateInterval);
e.preventDefault();
});

qianTong.addEventListener('touchmove', (e) => {
if (!isDragging) return;
const currentX = e.touches[0].clientX;
const deltaX = currentX - startX;
rotationAngle += deltaX * 0.5;
updateQianPositions();
startX = currentX;

const normalizedAngle = ((rotationAngle % 360) + 360) % 360;
currentIndex = Math.floor((normalizedAngle / 360) * 32) % 32;
selectedNum.textContent = `第 ${currentIndex + 1} 签`;
e.preventDefault();
});

qianTong.addEventListener('touchend', () => {
isDragging = false;
requestAnimationFrame(snapToNearest);
setTimeout(startAutoRotate, 1000);
});

// 鼠标交互（PC端）
qianTong.addEventListener('mousedown', (e) => {
isDragging = true;
startX = e.clientX;
clearInterval(autoRotateInterval);
e.preventDefault();
});

document.addEventListener('mousemove', (e) => {
if (!isDragging) return;
const currentX = e.clientX;
const deltaX = currentX - startX;
rotationAngle += deltaX * 0.5;
updateQianPositions();
startX = currentX;

const normalizedAngle = ((rotationAngle % 360) + 360) % 360;
currentIndex = Math.floor((normalizedAngle / 360) * 32) % 32;
selectedNum.textContent = `第 ${currentIndex + 1} 签`;
});

document.addEventListener('mouseup', () => {
if (isDragging) {
isDragging = false;
requestAnimationFrame(snapToNearest);
setTimeout(startAutoRotate, 1000);
}
});

// 防止右键菜单影响体验
qianTong.addEventListener('contextmenu', (e) => e.preventDefault());

// 背景粒子
function createParticles() {
for (let i = 0; i < 30; i++) {
const particle = document.createElement('div');
particle.className = 'particle';
const size = Math.random() * 6 + 2;
const left = Math.random() * 100;
const delay = Math.random() * 3;
const duration = Math.random() * 3 + 2;

particle.style.cssText = `
width: ${size}px;
height: ${size}px;
left: ${left}%;
top: -20px;
background: ${Math.random() > 0.5 ? '#FFD700' : '#C41E3A'};
border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
animation-delay: ${delay}s;
animation-duration: ${duration}s;
`;
particlesContainer.appendChild(particle);
setTimeout(() => particle.remove(), (delay + duration) * 1000);
}
}

function createSparkle() {
const sparkle = document.createElement('div');
sparkle.className = 'sparkle';
sparkle.style.cssText = `
left: ${Math.random() * 100}%;
top: ${Math.random() * 100}%;
animation-delay: ${Math.random() * 0.5}s;
`;
particlesContainer.appendChild(sparkle);
setTimeout(() => sparkle.remove(), 2000);
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
// 显示加载动画1.5秒
setTimeout(() => {
loadingOverlay.style.opacity = '0';
setTimeout(() => {
loadingOverlay.style.display = 'none';
}, 800);
}, 1500);

initQianTong();
createParticles();
setInterval(createParticles, 5000);
});

// 窗口大小变化时更新
window.addEventListener('resize', () => {
updateQianPositions();
resizeCanvas();
});

// 处理页面可见性变化，暂停/恢复动画
document.addEventListener('visibilitychange', () => {
if (document.hidden) {
clearInterval(autoRotateInterval);
} else if (!isDragging && !isDrawing) {
startAutoRotate();
}
});
</script>
</body>
</html>